rush_epa_per_play = "EPA Per Play",
pass_yards_to_go = "Yards to Go",
pass_yards_per_play = "Yards Per Play",
pass_success_rate = "Success Rate",
pass_first_down_rate = "First Down Rate",
pass_epa_per_play = "EPA Per Play") %>%
tab_header(title = html(paste0("Offensive Efficiency by Down - ", offense_team),
web_image(url = nfl_logos$team_logo_espn[which(nfl_logos$team_abbr == offense_team)], height = px(50))),
subtitle = "2021 season. Penalties removed. At least 2 minutes remaining in the half, win probability between 10% and 90%."
) %>%
# add outer border to table (gray)
opt_table_outline(style = "solid", width = px(3)) %>%
# add left border to column spanner
tab_style(
style = cell_borders(sides = c("left"), color = "#D3D3D3", weight = px(3), style = "solid"),
locations = cells_column_spanners(spanners = "All Plays")) %>%
# add left border to column spanner
tab_style(
style = cell_borders(sides = c("left"), color = "#D3D3D3", weight = px(3), style = "solid"),
locations = cells_column_spanners(spanners = "Rush")) %>%
# add left border to column spanner
tab_style(
style = cell_borders(sides = c("left"), color = "#D3D3D3", weight = px(3), style = "solid"),
locations = cells_column_spanners(spanners = "Pass")) %>%
# add left and right borders to body
tab_style(
style = cell_borders(sides = c("left"), color = "#D3D3D3", weight = px(3), style = "solid"),
locations = cells_body(columns = c(plays, rush_yards_to_go, pass_yards_to_go))) %>%
# add left and right borders to body
tab_style(
style = cell_borders(sides = c("left"), color = "#D3D3D3", weight = px(3), style = "solid"),
locations = cells_column_labels(columns = c(plays, rush_yards_to_go, pass_yards_to_go))) %>%
# add left and right borders to body
tab_style(
style = list(cell_text(weight = "bold")),
locations = cells_column_labels(columns = everything())) %>%
# add color to team cells
# tab_style(style = cell_fill(color = "blue"),
#           locations = cells_body(columns = vars(rush_epa_per_play),
#                                  rows = (posteam != "League" & down == 1))
#           ) %>%
tab_source_note(source_note = "Data from @nflfastR.") %>%
tab_source_note(source_note = "Table by @TripleRSports.") %>%
tab_style(
style = cell_fill(color = offense_team_color1),
locations = cells_body(
columns = c("pass_epa_per_play"),
rows = (down_string == "1st Down" & team == offense_team)
)
) %>%
tab_style(
style = cell_text(weight = "bold", color = offense_team_color2),
locations = cells_body(
columns = c("pass_epa_per_play"),
rows = (down_string == "1st Down" & team == offense_team)
)
) %>%
tab_style(
style = cell_fill(color = offense_team_color1),
locations = cells_body(
columns = c(first_down_rate, pass_epa_per_play),
rows = (down_string == "2nd Down" & team == offense_team)
)
) %>%
tab_style(
style = cell_text(weight = "bold", color = offense_team_color2),
locations = cells_body(
columns = c(first_down_rate, pass_epa_per_play),
rows = (down_string == "2nd Down" & team == offense_team)
)
) %>%
tab_style(
style = cell_fill(color = offense_team_color1),
locations = cells_body(
columns = c(pass_epa_per_play),
rows = (down_string == "3rd Down" & team == offense_team)
)
) %>%
tab_style(
style = cell_text(weight = "bold", color = offense_team_color2),
locations = cells_body(
columns = c(pass_epa_per_play),
rows = (down_string == "3rd Down" & team == offense_team)
)
)
View(defense_team_down_run_pass_summary_1)
View(defense_team_down_run_pass_summary_1)
View(defense_team_down_run_pass_summary_1)
offense_team = "SEA"
offense_team_color1 = nfl_logos$team_color[which(nfl_logos$team_abbr == offense_team)]
offense_team_color2 = nfl_logos$team_color3[which(nfl_logos$team_abbr == offense_team)]
# offense 1st down summary
offense_team_down_run_pass_summary_by_week <- pbp %>%
filter(season %in% c(season1)) %>%
filter(!is.na(down)) %>%
filter(down %in% c(1, 2, 3)) %>%
filter(pass == 1 | rush == 1) %>%
#filter(play_type_nfl != "PENALTY") %>%
filter(wp >= min_win_prob & wp <= max_win_prob) %>%
filter(half_seconds_remaining > 0) %>%
filter(posteam == offense_team) %>%
#filter(week %in% c(10, 11)) %>%
#mutate(down_group = ifelse(down < 3, "early down", "third down")) %>%
#mutate(week_group = ifelse(week >= 10, "Week 10+", "Weeks 1-9")) %>%
#group_by(defteam) %>%
group_by(week, down) %>%
summarize(plays = n(),
rush_percent = mean(rush, na.rm = TRUE),
pass_percent = mean(pass, na.rm = TRUE),
expected_pass_percent = mean(xpass, na.rm = TRUE),
average_yards_to_go = mean(ydstogo, na.rm = TRUE),
yards_per_play = mean(yards_gained, na.rm = TRUE),
success_rate = mean(success, na.rm = TRUE),
first_down_rate = mean(first_down, na.rm = TRUE),
epa_per_play = mean(epa, na.rm = TRUE),
rush_yards_to_go = sum(ydstogo * rush) / sum(rush, na.rm = TRUE),
rush_yards_per_play = sum(yards_gained * rush) / sum(rush, na.rm = TRUE),
rush_success_rate = sum(success * rush, na.rm = TRUE) / sum(rush, na.rm = TRUE),
rush_first_down_rate = sum(first_down * rush) / sum(rush, na.rm = TRUE),
rush_epa_per_play = sum(epa * rush, na.rm = TRUE) / sum(rush, na.rm = TRUE),
pass_yards_to_go = sum(ydstogo * pass, na.rm = TRUE) / sum(pass, na.rm = TRUE),
pass_yards_per_play = sum(yards_gained * pass, na.rm = TRUE) / sum(pass, na.rm = TRUE),
pass_success_rate = sum(success * pass, na.rm = TRUE) / sum(pass, na.rm = TRUE),
pass_first_down_rate = sum(first_down * pass, na.rm = TRUE) / sum(pass, na.rm = TRUE),
pass_epa_per_play = sum(epa * pass, na.rm = TRUE) / sum(pass, na.rm = TRUE)
)
# offense 1st down summary
offense_team_down_run_pass_summary_by_week <- pbp_data %>%
filter(season %in% c(season1)) %>%
filter(!is.na(down)) %>%
filter(down %in% c(1, 2, 3)) %>%
filter(pass == 1 | rush == 1) %>%
#filter(play_type_nfl != "PENALTY") %>%
filter(wp >= min_win_prob & wp <= max_win_prob) %>%
filter(half_seconds_remaining > 0) %>%
filter(posteam == offense_team) %>%
#filter(week %in% c(10, 11)) %>%
#mutate(down_group = ifelse(down < 3, "early down", "third down")) %>%
#mutate(week_group = ifelse(week >= 10, "Week 10+", "Weeks 1-9")) %>%
#group_by(defteam) %>%
group_by(week, down) %>%
summarize(plays = n(),
rush_percent = mean(rush, na.rm = TRUE),
pass_percent = mean(pass, na.rm = TRUE),
expected_pass_percent = mean(xpass, na.rm = TRUE),
average_yards_to_go = mean(ydstogo, na.rm = TRUE),
yards_per_play = mean(yards_gained, na.rm = TRUE),
success_rate = mean(success, na.rm = TRUE),
first_down_rate = mean(first_down, na.rm = TRUE),
epa_per_play = mean(epa, na.rm = TRUE),
rush_yards_to_go = sum(ydstogo * rush) / sum(rush, na.rm = TRUE),
rush_yards_per_play = sum(yards_gained * rush) / sum(rush, na.rm = TRUE),
rush_success_rate = sum(success * rush, na.rm = TRUE) / sum(rush, na.rm = TRUE),
rush_first_down_rate = sum(first_down * rush) / sum(rush, na.rm = TRUE),
rush_epa_per_play = sum(epa * rush, na.rm = TRUE) / sum(rush, na.rm = TRUE),
pass_yards_to_go = sum(ydstogo * pass, na.rm = TRUE) / sum(pass, na.rm = TRUE),
pass_yards_per_play = sum(yards_gained * pass, na.rm = TRUE) / sum(pass, na.rm = TRUE),
pass_success_rate = sum(success * pass, na.rm = TRUE) / sum(pass, na.rm = TRUE),
pass_first_down_rate = sum(first_down * pass, na.rm = TRUE) / sum(pass, na.rm = TRUE),
pass_epa_per_play = sum(epa * pass, na.rm = TRUE) / sum(pass, na.rm = TRUE)
)
# create gt pretty table for team offense
offense_team_down_run_pass_summary_by_week %>%
mutate(down_string = ifelse(down == 1, "1st Down",
ifelse(down == 2, "2nd Down",
ifelse(down == 3, "3rd Down", paste0(down, "th Down"))))) %>%
mutate(week_string = paste0("Week ", week)) %>%
select(-down) %>%
group_by(down_string) %>%
select(-week) %>%
gt(rowname_col = c("week_string")) %>%
tab_spanner(label = "All Plays",
columns = vars(plays, rush_percent, pass_percent, expected_pass_percent, average_yards_to_go, yards_per_play, success_rate, first_down_rate, epa_per_play)) %>%
tab_spanner(label = "Rush",
columns = vars(rush_yards_to_go, rush_yards_per_play, rush_success_rate, rush_first_down_rate, rush_epa_per_play)) %>%
tab_spanner(label = "Pass",
columns = vars(pass_yards_to_go, pass_yards_per_play, pass_success_rate, pass_first_down_rate, pass_epa_per_play)) %>%
fmt_percent(columns = vars(rush_percent, pass_percent, expected_pass_percent, success_rate, first_down_rate, rush_success_rate, rush_first_down_rate, pass_success_rate, pass_first_down_rate), decimals = 1) %>%
fmt_number(columns = vars(average_yards_to_go, yards_per_play, rush_yards_to_go, rush_yards_per_play, pass_yards_to_go, pass_yards_per_play), decimals = 1) %>%
fmt_number(columns = vars(epa_per_play, rush_epa_per_play, pass_epa_per_play), decimals = 2) %>%
cols_label(week_string = "Week",
plays = "# of Plays",
rush_percent = "Rush %",
pass_percent = "Pass %",
expected_pass_percent = "Expected Pass %",
average_yards_to_go = "Yards to Go",
yards_per_play = "Yards Per Play",
success_rate = "Success Rate",
first_down_rate = "First Down Rate",
epa_per_play = "EPA Per Play",
rush_yards_to_go = "Yards to Go",
rush_yards_per_play = "Yards Per Play",
rush_success_rate = "Success Rate",
rush_first_down_rate = "First Down Rate",
rush_epa_per_play = "EPA Per Play",
pass_yards_to_go = "Yards to Go",
pass_yards_per_play = "Yards Per Play",
pass_success_rate = "Success Rate",
pass_first_down_rate = "First Down Rate",
pass_epa_per_play = "EPA Per Play") %>%
tab_header(title = html(paste0("Offensive Efficiency by Down - ", offense_team), web_image(url = nfl_logos$team_logo_espn[which(nfl_logos$team_abbr == offense_team)], height = px(50))),
subtitle = paste0(season1, " season. Penalties removed. At least 0 seconds remaining in the half, win probability between ", min_win_prob, "% and ", max_win_prob, "%.")
) %>%
# add outer border to table (gray)
opt_table_outline(style = "solid", width = px(3)) %>%
# add left border to column spanner
tab_style(
style = cell_borders(sides = c("left"), color = "#D3D3D3", weight = px(3), style = "solid"),
locations = cells_column_spanners(spanners = "All Plays")) %>%
# add left border to column spanner
tab_style(
style = cell_borders(sides = c("left"), color = "#D3D3D3", weight = px(3), style = "solid"),
locations = cells_column_spanners(spanners = "Rush")) %>%
# add left border to column spanner
tab_style(
style = cell_borders(sides = c("left"), color = "#D3D3D3", weight = px(3), style = "solid"),
locations = cells_column_spanners(spanners = "Pass")) %>%
# add left and right borders to body
tab_style(
style = cell_borders(sides = c("left"), color = "#D3D3D3", weight = px(3), style = "solid"),
locations = cells_body(columns = vars(plays, rush_yards_to_go, pass_yards_to_go))) %>%
# add left and right borders to body
tab_style(
style = cell_borders(sides = c("left"), color = "#D3D3D3", weight = px(3), style = "solid"),
locations = cells_column_labels(columns = vars(plays, rush_yards_to_go, pass_yards_to_go))) %>%
# add left and right borders to body
tab_style(
style = list(cell_text(weight = "bold")),
locations = cells_column_labels(columns = TRUE)) %>%
# add color to team cells
# tab_style(style = cell_fill(color = "blue"),
#           locations = cells_body(columns = vars(rush_epa_per_play),
#                                  rows = (posteam != "League" & down == 1))
#           ) %>%
tab_source_note(source_note = "Data from @nflfastR.") %>%
tab_source_note(source_note = "Table by @TripleRSports.") %>%
tab_style(
style = cell_fill(color = offense_team_color1),
locations = cells_body(
columns = vars(rush_epa_per_play),
rows = (down_string == "1st Down")
)
) %>%
tab_style(
style = cell_text(weight = "bold", color = offense_team_color2),
locations = cells_body(
columns = vars(rush_epa_per_play),
rows = (down_string == "1st Down")
)
) %>%
tab_style(
style = cell_fill(color = offense_team_color1),
locations = cells_body(
columns = vars(pass_percent, pass_epa_per_play),
rows = (down_string == "2nd Down")
)
) %>%
tab_style(
style = cell_text(weight = "bold", color = offense_team_color2),
locations = cells_body(
columns = vars(pass_percent, pass_epa_per_play),
rows = (down_string == "2nd Down")
)
) %>%
tab_style(
style = cell_fill(color = offense_team_color1),
locations = cells_body(
columns = vars(average_yards_to_go, epa_per_play, pass_epa_per_play),
rows = (down_string == "3rd Down")
)
) %>%
tab_style(
style = cell_text(weight = "bold", color = offense_team_color2),
locations = cells_body(
columns = vars(average_yards_to_go, epa_per_play, pass_epa_per_play),
rows = (down_string == "3rd Down")
)
)
down_distance_summary <- pbp_data |>
filter(season == season1) |>
filter(season_type == "REG") |>
filter(!is.na(down)) |>
#filter(down == 3) |>
filter(pass == 1 | rush == 1) |>
filter(play_type_nfl != "PENALTY") |>
group_by(down, ydstogo) |>
summarize(plays = n(),
yards_per_play = sum(yards_gained, na.rm = TRUE),
first_down_rate = mean(first_down, na.rm = TRUE),
rush_plays = sum(rush, na.rm = TRUE),
rush_yards_per_play = sum(yards_gained * rush, na.rm = TRUE) / sum(rush, na.rm = TRUE),
rush_first_down_rate = sum(first_down * rush, na.rm = TRUE) / sum(rush, na.rm = TRUE),
pass_plays = sum(pass, na.rm = TRUE),
pass_yards_per_play = sum(yards_gained * pass, na.rm = TRUE) / sum(pass, na.rm = TRUE),
pass_first_down_rate = sum(first_down * pass, na.rm = TRUE) / sum(pass, na.rm = TRUE))
# with grouping by play type
down_distance_play_type_summary <- pbp_data |>
filter(season == season1) |>
filter(season_type == "REG") |>
filter(half_seconds_remaining >= 0) |>
filter(wp >= min_win_prob & wp <= max_win_prob) |>
filter(!is.na(down)) |>
#filter(down <= 3) |>
filter(pass == 1 | rush == 1) |>
filter(play_type_nfl != "PENALTY") |>
group_by(play_type, down, ydstogo) |>
summarize(plays = n(),
yards_per_play = mean(yards_gained, na.rm = TRUE),
first_down_rate = mean(first_down, na.rm = TRUE),
success_rate = mean(success, na.rm = TRUE),
epa_per_play = mean(epa, na.rm = TRUE)) |>
group_by(down, ydstogo) |>
mutate(pct_of_plays = plays / sum(plays)) |>
filter(ydstogo <= 20)
ggplot(data = down_distance_play_type_summary, aes(x = ydstogo, y = first_down_rate)) +
facet_grid(. ~ down) +
geom_point(aes(color = play_type, size = plays)) +
geom_smooth(aes(color = play_type)) +
scale_color_manual(values = c("blue", "red"))
View(down_distance_play_type_summary)
# offense 1st down summary
offense_team_down_run_pass_summary_1 <- pbp_data |>
filter(season %in% c(season1)) |>
filter(!is.na(down)) |>
filter(down == 1) |>
filter(pass == 1 | rush == 1) |>
#filter(play_type_nfl != "PENALTY") |>
filter(wp >= min_win_prob & wp <= max_win_prob) |>
#filter(half_seconds_remaining > 120) |>
#mutate(down_group = ifelse(down < 3, "early down", "third down")) |>
#group_by(defteam) |>
group_by(posteam) |>
summarize(plays = n(),
rush_percent = mean(rush, na.rm = TRUE),
pass_percent = mean(pass, na.rm = TRUE),
expected_pass_percent = mean(xpass, na.rm = TRUE),
average_yards_to_go = mean(ydstogo, na.rm = TRUE),
yards_per_play = mean(yards_gained, na.rm = TRUE),
success_rate = mean(success, na.rm = TRUE),
first_down_rate = mean(first_down, na.rm = TRUE),
epa_per_play = mean(epa, na.rm = TRUE),
rush_yards_to_go = sum(ydstogo * rush) / sum(rush, na.rm = TRUE),
rush_yards_per_play = sum(yards_gained * rush) / sum(rush, na.rm = TRUE),
rush_success_rate = sum(success * rush, na.rm = TRUE) / sum(rush, na.rm = TRUE),
rush_first_down_rate = sum(first_down * rush) / sum(rush, na.rm = TRUE),
rush_epa_per_play = sum(epa * rush, na.rm = TRUE) / sum(rush, na.rm = TRUE),
pass_yards_to_go = sum(ydstogo * pass, na.rm = TRUE) / sum(pass, na.rm = TRUE),
pass_yards_per_play = sum(yards_gained * pass, na.rm = TRUE) / sum(pass, na.rm = TRUE),
pass_success_rate = sum(success * pass, na.rm = TRUE) / sum(pass, na.rm = TRUE),
pass_first_down_rate = sum(first_down * pass, na.rm = TRUE) / sum(pass, na.rm = TRUE),
pass_epa_per_play = sum(epa * pass, na.rm = TRUE) / sum(pass, na.rm = TRUE)
)
# offense 2nd down summary
offense_team_down_run_pass_summary_2 <- pbp_data |>
filter(season %in% c(season1)) |>
filter(!is.na(down)) |>
filter(down == 2) |>
filter(pass == 1 | rush == 1) |>
#filter(play_type_nfl != "PENALTY") |>
filter(wp >= min_win_prob & wp <= max_win_prob) |>
#filter(half_seconds_remaining > 120) |>
#mutate(down_group = ifelse(down < 3, "early down", "third down")) |>
#group_by(defteam) |>
group_by(posteam) |>
summarize(plays = n(),
rush_percent = mean(rush, na.rm = TRUE),
pass_percent = mean(pass, na.rm = TRUE),
expected_pass_percent = mean(xpass, na.rm = TRUE),
average_yards_to_go = mean(ydstogo, na.rm = TRUE),
yards_per_play = mean(yards_gained, na.rm = TRUE),
success_rate = mean(success, na.rm = TRUE),
first_down_rate = mean(first_down, na.rm = TRUE),
epa_per_play = mean(epa, na.rm = TRUE),
rush_yards_to_go = sum(ydstogo * rush) / sum(rush, na.rm = TRUE),
rush_yards_per_play = sum(yards_gained * rush) / sum(rush, na.rm = TRUE),
rush_success_rate = sum(success * rush, na.rm = TRUE) / sum(rush, na.rm = TRUE),
rush_first_down_rate = sum(first_down * rush) / sum(rush, na.rm = TRUE),
rush_epa_per_play = sum(epa * rush, na.rm = TRUE) / sum(rush, na.rm = TRUE),
pass_yards_to_go = sum(ydstogo * pass, na.rm = TRUE) / sum(pass, na.rm = TRUE),
pass_yards_per_play = sum(yards_gained * pass, na.rm = TRUE) / sum(pass, na.rm = TRUE),
pass_success_rate = sum(success * pass, na.rm = TRUE) / sum(pass, na.rm = TRUE),
pass_first_down_rate = sum(first_down * pass, na.rm = TRUE) / sum(pass, na.rm = TRUE),
pass_epa_per_play = sum(epa * pass, na.rm = TRUE) / sum(pass, na.rm = TRUE)
)
# offense 3rd down summary
offense_team_down_run_pass_summary_3 <- pbp_data |>
filter(season %in% c(season1)) |>
filter(!is.na(down)) |>
filter(down == 3) |>
filter(pass == 1 | rush == 1) |>
#filter(play_type_nfl != "PENALTY") |>
filter(wp >= min_win_prob & wp <= max_win_prob) |>
#filter(half_seconds_remaining > 120) |>
#mutate(down_group = ifelse(down < 3, "early down", "third down")) |>
#group_by(defteam) |>
group_by(posteam) |>
summarize(plays = n(),
rush_percent = mean(rush, na.rm = TRUE),
pass_percent = mean(pass, na.rm = TRUE),
expected_pass_percent = mean(xpass, na.rm = TRUE),
average_yards_to_go = mean(ydstogo, na.rm = TRUE),
yards_per_play = mean(yards_gained, na.rm = TRUE),
success_rate = mean(success, na.rm = TRUE),
first_down_rate = mean(first_down, na.rm = TRUE),
epa_per_play = mean(epa, na.rm = TRUE),
rush_yards_to_go = sum(ydstogo * rush, na.rm = TRUE) / sum(rush, na.rm = TRUE),
rush_yards_per_play = sum(yards_gained * rush, na.rm = TRUE) / sum(rush, na.rm = TRUE),
rush_success_rate = sum(success * rush, na.rm = TRUE) / sum(rush, na.rm = TRUE),
rush_first_down_rate = sum(first_down * rush, na.rm = TRUE) / sum(rush, na.rm = TRUE),
rush_epa_per_play = sum(epa * rush, na.rm = TRUE) / sum(rush, na.rm = TRUE),
pass_yards_to_go = sum(ydstogo * pass, na.rm = TRUE) / sum(pass, na.rm = TRUE),
pass_yards_per_play = sum(yards_gained * pass, na.rm = TRUE) / sum(pass, na.rm = TRUE),
pass_success_rate = sum(success * pass, na.rm = TRUE) / sum(pass, na.rm = TRUE),
pass_first_down_rate = sum(first_down * pass, na.rm = TRUE) / sum(pass, na.rm = TRUE),
pass_epa_per_play = sum(epa * pass, na.rm = TRUE) / sum(pass, na.rm = TRUE)
)
# defense 1st down summary
defense_team_down_run_pass_summary_1 <- pbp_data |>
filter(season %in% c(season1)) |>
filter(!is.na(down)) |>
filter(down == 1) |>
filter(pass == 1 | rush == 1) |>
#filter(play_type_nfl != "PENALTY") |>
filter(wp >= min_win_prob & wp <= max_win_prob) |>
#filter(half_seconds_remaining > 120) |>
#mutate(down_group = ifelse(down < 3, "early down", "third down")) |>
group_by(defteam) |>
#group_by(posteam) |>
summarize(plays = n(),
rush_percent = mean(rush, na.rm = TRUE),
pass_percent = mean(pass, na.rm = TRUE),
expected_pass_percent = mean(xpass, na.rm = TRUE),
average_yards_to_go = mean(ydstogo, na.rm = TRUE),
yards_per_play = mean(yards_gained, na.rm = TRUE),
success_rate = mean(success, na.rm = TRUE),
first_down_rate = mean(first_down, na.rm = TRUE),
epa_per_play = mean(epa, na.rm = TRUE),
rush_yards_to_go = sum(ydstogo * rush, na.rm = TRUE) / sum(rush, na.rm = TRUE),
rush_yards_per_play = sum(yards_gained * rush, na.rm = TRUE) / sum(rush, na.rm = TRUE),
rush_success_rate = sum(success * rush, na.rm = TRUE) / sum(rush, na.rm = TRUE),
rush_first_down_rate = sum(first_down * rush, na.rm = TRUE) / sum(rush, na.rm = TRUE),
rush_epa_per_play = sum(epa * rush, na.rm = TRUE) / sum(rush, na.rm = TRUE),
pass_yards_to_go = sum(ydstogo * pass, na.rm = TRUE) / sum(pass, na.rm = TRUE),
pass_yards_per_play = sum(yards_gained * pass, na.rm = TRUE) / sum(pass, na.rm = TRUE),
pass_success_rate = sum(success * pass, na.rm = TRUE) / sum(pass, na.rm = TRUE),
pass_first_down_rate = sum(first_down * pass, na.rm = TRUE) / sum(pass, na.rm = TRUE),
pass_epa_per_play = sum(epa * pass, na.rm = TRUE) / sum(pass, na.rm = TRUE)
)
# defense 2nd down summary
defense_team_down_run_pass_summary_2 <- pbp_data |>
filter(season %in% c(season1)) |>
filter(!is.na(down)) |>
filter(down == 2) |>
filter(pass == 1 | rush == 1) |>
#filter(play_type_nfl != "PENALTY") |>
filter(wp >= min_win_prob & wp <= max_win_prob) |>
#filter(half_seconds_remaining > 120) |>
#mutate(down_group = ifelse(down < 3, "early down", "third down")) |>
group_by(defteam) |>
#group_by(posteam) |>
summarize(plays = n(),
rush_percent = mean(rush, na.rm = TRUE),
pass_percent = mean(pass, na.rm = TRUE),
expected_pass_percent = mean(xpass, na.rm = TRUE),
average_yards_to_go = mean(ydstogo, na.rm = TRUE),
yards_per_play = mean(yards_gained, na.rm = TRUE),
success_rate = mean(success, na.rm = TRUE),
first_down_rate = mean(first_down, na.rm = TRUE),
epa_per_play = mean(epa, na.rm = TRUE),
rush_yards_to_go = sum(ydstogo * rush, na.rm = TRUE) / sum(rush, na.rm = TRUE),
rush_yards_per_play = sum(yards_gained * rush, na.rm = TRUE) / sum(rush, na.rm = TRUE),
rush_success_rate = sum(success * rush, na.rm = TRUE) / sum(rush, na.rm = TRUE),
rush_first_down_rate = sum(first_down * rush, na.rm = TRUE) / sum(rush, na.rm = TRUE),
rush_epa_per_play = sum(epa * rush, na.rm = TRUE) / sum(rush, na.rm = TRUE),
pass_yards_to_go = sum(ydstogo * pass, na.rm = TRUE) / sum(pass, na.rm = TRUE),
pass_yards_per_play = sum(yards_gained * pass, na.rm = TRUE) / sum(pass, na.rm = TRUE),
pass_success_rate = sum(success * pass, na.rm = TRUE) / sum(pass, na.rm = TRUE),
pass_first_down_rate = sum(first_down * pass, na.rm = TRUE) / sum(pass, na.rm = TRUE),
pass_epa_per_play = sum(epa * pass, na.rm = TRUE) / sum(pass, na.rm = TRUE)
)
# defense 3rd down summary
defense_team_down_run_pass_summary_3 <- pbp_data |>
filter(season %in% c(season1)) |>
filter(!is.na(down)) |>
filter(down == 3) |>
filter(pass == 1 | rush == 1) |>
#filter(play_type_nfl != "PENALTY") |>
filter(wp >= min_win_prob & wp <= max_win_prob) |>
#filter(half_seconds_remaining > 120) |>
#mutate(down_group = ifelse(down < 3, "early down", "third down")) |>
group_by(defteam) |>
#group_by(posteam) |>
summarize(plays = n(),
rush_percent = mean(rush, na.rm = TRUE),
pass_percent = mean(pass, na.rm = TRUE),
expected_pass_percent = mean(xpass, na.rm = TRUE),
average_yards_to_go = mean(ydstogo, na.rm = TRUE),
yards_per_play = mean(yards_gained, na.rm = TRUE),
success_rate = mean(success, na.rm = TRUE),
first_down_rate = mean(first_down, na.rm = TRUE),
epa_per_play = mean(epa, na.rm = TRUE),
rush_yards_to_go = sum(ydstogo * rush, na.rm = TRUE) / sum(rush, na.rm = TRUE),
rush_yards_per_play = sum(yards_gained * rush, na.rm = TRUE) / sum(rush, na.rm = TRUE),
rush_success_rate = sum(success * rush, na.rm = TRUE) / sum(rush, na.rm = TRUE),
rush_first_down_rate = sum(first_down * rush, na.rm = TRUE) / sum(rush, na.rm = TRUE),
rush_epa_per_play = sum(epa * rush, na.rm = TRUE) / sum(rush, na.rm = TRUE),
pass_yards_to_go = sum(ydstogo * pass, na.rm = TRUE) / sum(pass, na.rm = TRUE),
pass_yards_per_play = sum(yards_gained * pass, na.rm = TRUE) / sum(pass, na.rm = TRUE),
pass_success_rate = sum(success * pass, na.rm = TRUE) / sum(pass, na.rm = TRUE),
pass_first_down_rate = sum(first_down * pass, na.rm = TRUE) / sum(pass, na.rm = TRUE),
pass_epa_per_play = sum(epa * pass, na.rm = TRUE) / sum(pass, na.rm = TRUE)
)
